# Примеры умных уведомлений и UI настроек

## 📱 ПРИМЕРЫ УВЕДОМЛЕНИЙ В TELEGRAM

### 1. Новый Fixed стейкинг (уведомляется сразу)

```
🆕 НОВЫЙ СТЕЙКИНГ!

💎 Монета: BTC
🏦 Биржа: Gate.io
📊 APR: 15.5%
📅 Период: Fixed (30 дней)
🎯 Тип: Fixed/Flexible
🟢 Статус: Active

📊 Категория: Fixed: 15.0% | Flexible: 16.0%

☑️ Заполненность: 45.3%
🟢🟢⚪⚪⚪⚪⚪⚪⚪⚪

💵 ЛИМИТ НА ЧЕЛОВЕКА:
├─ Макс. сумма: 50,000.00 BTC

💰 Цена токена: $95,234.50
💼 Стоимость пула: ~$4,761,725,000.00

🔗 Страница: https://www.gate.io/earn

⏱️ Уведомление: Новый Fixed стейкинг (отправлено сразу)
```

### 2. Новый Flexible стейкинг (после 6 часов стабилизации)

```
🆕 НОВЫЙ СТЕЙКИНГ! [СТАБИЛИЗИРОВАН]

💎 Монета: ETH
🏦 Биржа: Gate.io
📊 APR: 8.2%
📅 Период: Flexible (бессрочно)
🎯 Тип: Fixed/Flexible
🟢 Статус: Active

📊 Категория: Fixed: 7.5% | Flexible: 8.2%

☑️ Заполненность: 23.1%
🟢🟢⚪⚪⚪⚪⚪⚪⚪⚪

💵 ЛИМИТ НА ЧЕЛОВЕКА:
├─ Макс. сумма: 1,000.00 ETH

💰 Цена токена: $3,456.78
💼 Стоимость пула: ~$34,567,800.00

🔗 Страница: https://www.gate.io/earn

⏱️ Уведомление: Flexible стейкинг стабилизирован (6 часов без изменений)
⏰ Добавлен: 2026-01-13 12:00 UTC
⏰ Стабилизирован: 2026-01-13 18:00 UTC
```

### 3. Изменение APR в Fixed стейкинге (уведомляется сразу)

```
📈 ИЗМЕНЕНИЕ APR!

💎 Монета: BTC
🏦 Биржа: Gate.io
📊 Новый APR: 18.5%
📊 Старый APR: 15.5%
🔺 Изменение: +3.0% (↑ 19.4%)

📅 Период: Fixed (30 дней)
🎯 Тип: Fixed/Flexible
🟢 Статус: Active

📊 Категория: Fixed: 18.0% | Flexible: 19.0%

☑️ Заполненность: 67.8%
🟢🟢🟢🟢🟢🟢🟡⚪⚪⚪

💵 ЛИМИТ НА ЧЕЛОВЕКА:
├─ Макс. сумма: 50,000.00 BTC

💰 Цена токена: $96,123.45
💼 Стоимость пула: ~$4,806,172,500.00

🔗 Страница: https://www.gate.io/earn

⏱️ Уведомление: Изменение APR ≥ 5% (Fixed стейкинг)
```

### 4. Изменение APR в Flexible стейкинге (после 6 часов стабилизации)

```
📈 ИЗМЕНЕНИЕ APR! [СТАБИЛИЗИРОВАН]

💎 Монета: ETH
🏦 Биржа: Gate.io
📊 Новый APR: 12.8%
📊 Старый APR: 8.2%
🔺 Изменение: +4.6% (↑ 56.1%)

📅 Период: Flexible (бессрочно)
🎯 Тип: Fixed/Flexible
🟢 Статус: Active

📊 Категория: Fixed: 12.0% | Flexible: 12.8%

☑️ Заполненность: 45.6%
🟢🟢🟢🟢⚪⚪⚪⚪⚪⚪

💵 ЛИМИТ НА ЧЕЛОВЕКА:
├─ Макс. сумма: 1,000.00 ETH

💰 Цена токена: $3,567.89
💼 Стоимость пула: ~$35,678,900.00

🔗 Страница: https://www.gate.io/earn

⏱️ Уведомление: APR изменился и стабилизировался
⏰ Последнее изменение: 2026-01-13 20:00 UTC
⏰ Стабилизирован: 2026-01-14 02:00 UTC
```

### 5. Combined стейкинг (уведомляется сразу как Fixed)

```
🆕 НОВЫЙ СТЕЙКИНГ!

💎 Монета: USDT
🏦 Биржа: Gate.io
📊 APR: 10.5%
📅 Период: Combined (Fixed + Flexible)
🎯 Тип: Fixed/Flexible
🟢 Статус: Active

📊 Категория: Fixed: 10.5% | Flexible: 9.8%

☑️ Заполненность: 12.3%
🟢🟢⚪⚪⚪⚪⚪⚪⚪⚪

💵 ЛИМИТ НА ЧЕЛОВЕКА:
├─ Макс. сумма: 100,000.00 USDT

💰 Цена токена: $1.00
💼 Стоимость пула: ~$10,000,000.00

🔗 Страница: https://www.gate.io/earn

⏱️ Уведомление: Combined стейкинг (обрабатывается как Fixed)
💡 Содержит Fixed и Flexible опции
```

---

## ⚙️ UI НАСТРОЕК УМНЫХ УВЕДОМЛЕНИЙ

### Расположение кнопки

**Путь в боте:**
```
Главное меню → Управление ссылками → [Выбор стейкинг-ссылки] → Текущие стейкинги → 🔔 Настройки уведомлений
```

**Клавиатура "Текущие стейкинги" (обновленная):**
```
┌───────────────────────────────────┐
│   ⬅️ Назад    │    Вперед ➡️       │  (если есть страницы)
├───────────────────────────────────┤
│   🔄 Обновить  │  ⚙️ Настройки APR │
├───────────────────────────────────┤
│        🔔 Настройки уведомлений    │  ← НОВАЯ КНОПКА
├───────────────────────────────────┤
│            ❌ Закрыть              │
└───────────────────────────────────┘
```

### Меню настроек уведомлений

**При нажатии на "🔔 Настройки уведомлений" открывается:**

```
⚙️ НАСТРОЙКИ УМНЫХ УВЕДОМЛЕНИЙ

🏦 Биржа: GateStaking
📌 Категория: Стейкинг

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 ТЕКУЩИЕ НАСТРОЙКИ:

🔔 Новые стейкинги: ✅ Включено
📈 Изменения APR: ✅ Включено
📊 Заполненность: ❌ Выключено

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⏱️ FLEXIBLE СТЕЙКИНГИ:
├─ Время стабилизации: 6 часов
├─ Уведомлять после стабилизации: ✅ Да
└─ Только стабильные: ✅ Да

⚡ FIXED СТЕЙКИНГИ:
├─ Уведомлять сразу: ✅ Да
└─ Combined как Fixed: ✅ Да

📊 ИЗМЕНЕНИЯ APR:
└─ Минимальное изменение: 5.0%

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Выберите действие:

┌───────────────────────────────────────┐
│  ⏱️ Изменить время стабилизации       │
├───────────────────────────────────────┤
│  📊 Изменить порог изменения APR      │
├───────────────────────────────────────┤
│  🔔 Новые стейкинги (вкл/выкл)        │
├───────────────────────────────────────┤
│  📈 Изменения APR (вкл/выкл)          │
├───────────────────────────────────────┤
│  ⚡ Fixed сразу (вкл/выкл)            │
├───────────────────────────────────────┤
│  🔄 Combined как Fixed (вкл/выкл)     │
├───────────────────────────────────────┤
│  📋 Только стабильные Flexible (вкл/выкл) │
├───────────────────────────────────────┤
│              ❌ Назад                  │
└───────────────────────────────────────┘
```

### Настройка времени стабилизации

**При нажатии на "⏱️ Изменить время стабилизации":**

```
⏱️ НАСТРОЙКА ВРЕМЕНИ СТАБИЛИЗАЦИИ

🏦 Биржа: GateStaking
📌 Текущее значение: 6 часов

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 Flexible стейкинги будут уведомлять
   только после X часов стабильного APR

Выберите новое значение:

┌─────────┬─────────┬─────────┐
│  1 час  │  2 часа │  3 часа │
├─────────┼─────────┼─────────┤
│  4 часа │  6 часов│  8 часов│
├─────────┼─────────┼─────────┤
│ 12 часов│ 24 часа │ 48 часов│
└─────────┴─────────┴─────────┘
        ❌ Отмена
```

### Настройка порога изменения APR

**При нажатии на "📊 Изменить порог изменения APR":**

```
📊 НАСТРОЙКА ПОРОГА ИЗМЕНЕНИЯ APR

🏦 Биржа: GateStaking
📌 Текущее значение: 5.0%

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 Уведомлять только если APR изменился
   на X% или больше (абсолютное изменение)

Примеры:
• 20% → 25% = изменение 5%
• 100% → 110% = изменение 10%

Выберите новое значение:

┌────────┬────────┬────────┬────────┐
│  1%    │   2%   │   3%   │   5%   │
├────────┼────────┼────────┼────────┤
│  10%   │  15%   │  20%   │  50%   │
└────────┴────────┴────────┴────────┘
          ❌ Отмена
```

### Переключатели (вкл/выкл)

**При нажатии на любую кнопку переключения (например "🔔 Новые стейкинги"):**

```
✅ Успешно изменено!

🔔 Новые стейкинги: ❌ ВЫКЛЮЧЕНО

Уведомления о новых стейкингах больше
не будут отправляться для этой биржи.

Вернуться в настройки?

┌─────────────────────────────────────┐
│        ⚙️ Настройки уведомлений     │
├─────────────────────────────────────┤
│              ❌ Закрыть              │
└─────────────────────────────────────┘
```

---

## 🎯 КЛЮЧЕВЫЕ ОСОБЕННОСТИ UI

### 1. Понятность
- Ясные названия кнопок
- Объяснения для каждой настройки
- Примеры расчетов для порога APR

### 2. Визуальные индикаторы
- ✅ Включено / ❌ Выключено
- Текущее значение всегда видно
- Группировка настроек по типам

### 3. Безопасность
- Все изменения сохраняются в БД сразу
- Можно отменить на каждом этапе
- Настройки применяются только к выбранной ссылке

### 4. Доступность
- Клавиатура находится в логичном месте
- Не нужно искать настройки в главном меню
- Контекстно привязана к конкретной бирже

---

## 📊 СРАВНЕНИЕ ТИПОВ УВЕДОМЛЕНИЙ

| Тип стейкинга | Новый | Изменение APR | Стабилизация |
|---------------|-------|---------------|--------------|
| **Fixed** | ✅ Сразу | ✅ Сразу (если ≥ порог) | ❌ Не требуется |
| **Flexible** | ⏳ После 6ч | ⏳ После 6ч (если ≥ порог) | ✅ Обязательно |
| **Combined** | ✅ Сразу (как Fixed) | ✅ Сразу (если ≥ порог) | ❌ Не требуется |
| **Unknown** | ❓ Не отправляется | ❓ Не отправляется | ❌ Не требуется |

---

## 🔧 ТЕХНИЧЕСКИЕ ДЕТАЛИ

### Настройки хранятся в таблице `api_links`:

```python
# Флаги уведомлений
notify_new_stakings: bool = True
notify_apr_changes: bool = True
notify_fill_changes: bool = False

# Пороги и таймауты
notify_min_apr_change: float = 5.0  # процент (абсолютное изменение)
flexible_stability_hours: int = 6   # часов стабильности

# Поведение типов
fixed_notify_immediately: bool = True
notify_combined_as_fixed: bool = True
notify_only_stable_flexible: bool = True
```

### Фильтрация min_apr применяется ВЕЗДЕ:

```python
# В bot/parser_service.py
if staking['apr'] < min_apr:
    # Не добавляем в new_stakings
    continue
```

### Отслеживание стабильности:

```python
# В services/stability_tracker_service.py
if lock_type == 'Flexible':
    time_stable = (now - staking.stable_since).total_seconds() / 3600
    if time_stable >= api_link.flexible_stability_hours:
        # Готово к уведомлению
        return {'should_notify': True}
```

---

Конец файла примеров
